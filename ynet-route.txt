// Manually fetch news from Ynet
app.get('/api/fetch-ynet', async (req: Request, res: Response) => {
  try {
    const category = req.query.category as string || 'business';
    
    console.log(`Manual fetch from Ynet for category: ${category}`);
    const articles = await fetchNewsFromAPI(category);
    
    // Create a new topic if we have articles
    if (articles.length > 0) {
      // Use the first article's title as the topic title
      const topicTitle = articles[0].title;
      const topicSummary = articles[0].content;
      
      // Create or get topic
      const topic = await storage.upsertTopic({
        title: topicTitle,
        summary: topicSummary,
        category,
        updatedAt: new Date()
      });
      
      // Add articles to the topic
      for (const article of articles) {
        await storage.upsertArticle({
          title: article.title,
          content: article.content,
          summary: article.summary || null,
          url: article.url,
          imageUrl: article.imageUrl || null,
          source: article.source,
          category,
          publishedAt: new Date(article.publishedAt),
          topicId: topic.id
        });
      }
      
      res.json({ 
        message: `Fetched ${articles.length} articles from Ynet for category: ${category}`, 
        topic,
        articles: articles.slice(0, 5).map(a => a.title)  // Show just a sample
      });
    } else {
      res.json({ message: 'No articles found for category: ' + category });
    }
  } catch (error) {
    console.error('Error in /api/fetch-ynet:', error);
    res.status(500).json({ message: 'Error fetching from Ynet', error: String(error) });
  }
});
